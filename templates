<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>TechSevak Command Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f4f7fb; font-family: 'Segoe UI', sans-serif; }
    .hero { background: linear-gradient(90deg,#ff7a00,#0b5ed7); color: white; border-radius: 12px; padding: 20px; }
    .card-custom { border-radius: 12px; transition: transform 0.2s; }
    .card-custom:hover { transform: scale(1.02); box-shadow: 0 6px 16px rgba(0,0,0,0.15); }
    .highlight { color: #ff7a00; font-weight: 700; }
    footer { font-size: 0.9rem; }
  </style>
</head>
<body>
<div class="container mt-3">

  <!-- HERO HEADER -->
  <div class="hero d-flex justify-content-between align-items-center">
    <div class="d-flex align-items-center">
      <img src="{{ url_for('static', filename='techsevaklogo.png') }}" alt="logo" width="140" class="me-3">
      <div>
        <h1 class="mb-0 fw-bold">TechSevak</h1>
        <div>"Jaha Dharm, Waha Sevak"</div>
        <small class="text-light">Smart Command & Safety Dashboard</small>
      </div>
    </div>
    <div class="text-center">
      <h3 class="fw-bold">जय श्री महाकाल 🙏</h3>
      <img src="{{ url_for('static', filename='mahakaltemple.jpg') }}" alt="temple" width="90">
    </div>
    <div class="text-end">
      <div id="live-time" class="fw-bold">{{ time_str }}</div>
      <small>Committee & Management Use Only</small>
    </div>
  </div>

  <!-- INTRO -->
  <div class="mt-4 p-4 bg-white rounded shadow-sm text-center">
    <h4 class="fw-bold text-primary">🌐 About TechSevak</h4>
    <p>
      TechSevak is a <span class="highlight">smart AI-driven command system</span> designed for 
      <b>Simhastha Ujjain 2028</b>. It ensures <b>real-time crowd monitoring, 
      missing person coordination, and emergency response</b>.  
      A system built not just with technology, but with the spirit of <span class="highlight">Seva</span>.  
    </p>
    <em class="text-muted">"Every Sevak is a guardian of faith, safety, and service."</em>
  </div>

  <!-- MAIN ROW -->
  <div class="row mt-4">

    <!-- Ghats Monitoring -->
    <div class="col-lg-6">
      <h3 class="mb-3 text-primary fw-bold">📍 Ghats Monitoring</h3>
      <div class="row">
        {% for name, info in ghats.items() %}
        <div class="col-md-6 mb-3">
          <div class="card card-custom p-3 border-start border-4 border-warning">
            <h5 class="fw-bold text-primary">{{ name }}</h5>
            <p class="mb-1"><strong>Capacity:</strong> {{ info.capacity }}</p>
            <p class="mb-1"><strong>Current:</strong> 
              <span class="highlight" id="cnt-{{ name|replace(' ','_') }}">{{ info.current }}</span>
            </p>

            {% if name != "Ramghat" %}
            <!-- Manual Update Form -->
            <form class="d-flex gap-2 mt-2" method="post" action="/update_count">
                <input type="hidden" name="ghat" value="{{ name }}">
                <input type="number" name="count" min="0" class="form-control form-control-sm" placeholder="Update count">
                <button class="btn btn-sm btn-warning text-white fw-bold">Update</button>
            </form>
            {% else %}
            <!-- Ramghat live AI -->
            <div class="mt-2"><small class="text-muted">Ramghat live AI count</small></div>

            <!-- Video Upload Form -->
            <form action="/upload_video" method="post" enctype="multipart/form-data" class="mt-2">
                <input type="file" name="video" accept="video/mp4" class="form-control mb-2" required>
                <button type="submit" class="btn btn-warning btn-sm fw-bold">Upload Video for AI Count</button>
            </form>

            <!-- Snapshot Display -->
            {% if ghats['Ramghat']['webcam_image'] %}
            <img src="{{ url_for('static', filename='snapshots/' + ghats['Ramghat']['webcam_image']) }}" 
                 alt="Overcrowd Screenshot" width="100%" class="mt-2 rounded shadow-sm">
            {% endif %}

            <!-- Overcrowd alert -->
            <li class="list-group-item text-danger fw-bold" id="overcrowd-alert" style="display:none;">
              ⚠️ Overcrowd Detected at Ramghat
            </li>
            {% endif %}

          </div>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- Right Column -->
    <div class="col-lg-6">

      <!-- Missing Person -->
      <div class="card card-custom p-3 mb-3 border-start border-4 border-primary">
        <div class="d-flex justify-content-between align-items-center">
          <h4 class="text-primary fw-bold">👤 Missing Person</h4>
          <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#missingModal">Report</button>
        </div>
        <hr>
        <h6 class="fw-bold">Active Reports</h6>
        <ul class="list-group">
          {% for r in missing_persons %}
          <li class="list-group-item">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <div class="fw-bold">{{ r.name }}</div>
                <small>Parents: {{ r.parents }} | Reported at: {{ r.reported_at }}</small><br>
                <small>Status: 
                  {% if r.found_at %}
                    ✅ Found at <strong>{{ r.found_at }}</strong>
                  {% else %}
                    <span class="text-danger fw-bold">Missing</span>
                  {% endif %}
                </small>
              </div>
              <div>
                {% if not r.found_at %}
                <form method="post" action="/found_person" class="d-flex gap-2">
                  <input type="hidden" name="id" value="{{ r.id }}">
                  <select name="found_at" class="form-select form-select-sm" required>
                    <option value="" disabled selected>Found at...</option>
                    {% for name in ghats.keys() %}
                    <option value="{{ name }}">{{ name }}</option>
                    {% endfor %}
                  </select>
                  <button class="btn btn-sm btn-success fw-bold">Update</button>
                </form>
                {% endif %}
              </div>
            </div>
          </li>
          {% else %}
          <li class="list-group-item">No active missing reports.</li>
          {% endfor %}
        </ul>
      </div>

      <!-- Alerts -->
      <div class="card card-custom p-3 mb-3 border-start border-4 border-success">
        <h4 class="text-primary fw-bold">⚡ Live Alerts</h4>
        <ul class="list-group">
          {% for a in alerts %}
          <li class="list-group-item">{{ a }}</li>
          {% else %}
          <li class="list-group-item text-muted">No alerts</li>
          {% endfor %}
        </ul>
      </div>

      <!-- Add Emergency Alert -->
<form method="post" action="/add_alert" class="d-flex gap-2 mt-2">
    <input type="text" name="alert" class="form-control form-control-sm" placeholder="Type emergency alert..." required>
    <button type="submit" class="btn btn-sm btn-danger fw-bold">Add Alert</button>
</form>


    
      <!-- Drone Monitoring -->
      <div class="card card-custom p-3 mb-3 border-start border-4 border-info">
        <h4 class="text-primary fw-bold">🛸 Drone Monitoring</h4>
        <div class="row">
          {% for d in drones %}
          <div class="col-md-6 mb-2">
            <div class="p-3 border rounded shadow-sm">
              <h6 class="fw-bold">Drone {{ d.id }}</h6>
              <p>Status: 
                {% if d.status == "Normal" %}
                  <span class="text-success">✅ All Good</span>
                {% elif d.status == "Crowd" %}
                  <span class="text-warning">⚠️ Crowd Detected</span>
                {% elif d.status == "Traffic" %}
                  <span class="text-danger">🚦 Traffic Issue</span>
                {% else %}
                  <span class="text-muted">🕒 No Update</span>
                {% endif %}
              </p>
              <small>Last Update: {{ d.updated_at }}</small>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>

      <!-- Emergency Numbers -->
      <div class="card card-custom p-3 border-start border-4 border-danger">
        <h4 class="text-primary fw-bold">📞 Emergency Numbers</h4>
        <ul class="list-group">
          <li class="list-group-item"><strong>🚓 Police:</strong> 100</li>
          <li class="list-group-item"><strong>🚑 Ambulance:</strong> 108</li>
          <li class="list-group-item"><strong>🚒 Fire Brigade:</strong> 101</li>
          <li class="list-group-item"><strong>👩 Women Helpline:</strong> 1091</li>
        </ul>
      </div>

    </div>
  </div>

  <!-- FOOTER -->
  <div class="mt-4 p-3 text-center bg-white rounded shadow-sm">
    <small>© TechSevak — Prototype for Ujjain MahaKumbh Hackathon 2025 BY Harsha INdulkar And anuj. Affiliated by MPSeDC & Department of Science & Technology, Govt. of Madhya Pradesh.</small>
  </div>
</div>

<!-- Missing Person Modal -->
<div class="modal fade" id="missingModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <form method="post" action="/report_missing" enctype="multipart/form-data" class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Report Missing Person</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <input name="name" class="form-control mb-2" placeholder="Person Name" required>
        <input name="parents" class="form-control mb-2" placeholder="Parent / Guardian Name" required>
        <select name="ghat" class="form-control mb-2" required>
          {% for name in ghats.keys() %}
          <option value="{{ name }}">{{ name }}</option>
          {% endfor %}
        </select>
        <input type="file" name="photo" accept="image/*" class="form-control">
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button class="btn btn-primary">Report Missing</button>
      </div>
    </form>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // Live time
  setInterval(()=> {
    document.getElementById("live-time").innerText = new Date().toLocaleString();
  },1000);

  // Overcrowd alert show
  {% if ghats['Ramghat']['current'] > 5 %}
    document.getElementById("overcrowd-alert").style.display = "block";
  {% endif %}
</script>
</body>
</html>
